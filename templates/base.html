<!DOCTYPE html>
<html lang="en" class="h-100">
{% load static %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    
    <title>WEB-GIS Dashboard</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap53.css' %}">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="{% static 'assets/bootstrap-icons-1.11.3/font/bootstrap-icons.css' %}">

    <!-- Fonts -->
    <link rel="stylesheet" href="{% static 'assets/fonts/css/fonts.css' %}">

    <!-- Style CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/modules/main.css' %}">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="{% static 'lib/leaflet/dist/leaflet.css' %}">

    <!-- Loader CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/loader.css' %}">

    {# External CDN links can stay commented out or restored if needed #}
    <!-- <link rel="stylesheet" href="https://js.arcgis.com/3.46/esri/css/esri.css">
    <link rel="stylesheet" href="https://js.arcgis.com/3.46/dijit/themes/claro/claro.css"> -->


</head>

<body>

    <!-- Loader Overlay -->
    <div id="page-loader" class="loader-overlay d-none">
        <div class="loader-content">
            <div class="spinner-border text-success" role="status">
            <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 fw-semibold text-success">Fetching Data...</p>
        </div>
    </div>


    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="{% static 'assets/img/images/logo1.png' %}" alt="logo" class="mx-1" width="40" height="40">
                <img src="{% static 'assets/img/images/DecisionHubLogo.png' %}" class="pe-1" alt="logo" width="" height="">
            </a>
            <div class="navbar-tabs d-none d-lg-flex flex-grow-1 justify-content-center gap-3">
                <a href="{% url 'land' %}" class="nav-tab {% if request.resolver_match.url_name == 'land' %}active{% endif %}">Land</a>
                <a href="{% url 'townplan' %}" class="nav-tab {% if request.resolver_match.url_name == 'townplan' %}active{% endif %}">Townplan</a>
                <a href="{% url 'cheif_engineering' %}" class="nav-tab {% if request.resolver_match.url_name == 'cheif_engineering' %}active{% endif %}">Cheif Engineering</a>
                <a href="{% url 'horticulture' %}" class="nav-tab {% if request.resolver_match.url_name == 'horticulture' %}active{% endif %}">Horticulture</a>
                <a href="{% url 'security' %}" class="nav-tab {% if request.resolver_match.url_name == 'security' %}active{% endif %}">Security</a>
                <a href="{% url 'coregis' %}" class="nav-tab {% if request.resolver_match.url_name == 'coregis' %}active{% endif %}">CoreGIS</a>
                <a href="{% url 'query_engine' %}" class="nav-tab {% if request.resolver_match.url_name == 'query_engine' %}active{% endif %}">Query Engine</a>
                <a hidden href="#" class="nav-tab {% if request.resolver_match.url_name == 'analytics' %}active{% endif %}">Analytics</a>
            </div>


            <div class="d-flex align-items-center ms-auto">
                <div class="dropdown">
                    <button class="btn dropdown-toggle" type="button" id="accountMenuButton" data-bs-toggle="dropdown"
                        aria-expanded="false" aria-label="Account">
                        <i class="bi bi-power fs-5"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="accountMenuButton">
                        <li>
                            <h6 class="dropdown-header mb-0">{{ request.user.username}}</h6>
                        </li>
                        {% if request.user.is_superuser%}
                        <li><span class="dropdown-item-text text-muted small">Role: Admin</span></li>
                        {%endif%}
                        <li>
                            <hr class="dropdown-divider" />
                        </li>
                        <li><a href = "{% url 'logout'%}" class="dropdown-item text-danger" id="logoutBtn" type="button">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    {% block content %}
    {% endblock %}

    <script>
        window.IP_karachi_city = "{{IP_karachi_city | safe | escapejs}}";
        window.IP_karachi = "{{IP_karachi | safe | escapejs}}";
        window.IP_lahore = "{{IP_lahore | safe | escapejs}}";
        window.IP_gujranwala = "{{IP_gujranwala | safe | escapejs}}";
        window.IP_bahawalpur = "{{IP_bahawalpur | safe | escapejs}}";
        window.IP_islamabad = "{{IP_islamabad | safe | escapejs}}";
        window.IP_multan = "{{IP_multan | safe | escapejs}}";
        window.IP_peshawar = "{{IP_peshawar | safe | escapejs}}";
        window.IP_quetta = "{{IP_quetta | safe | escapejs}}";
    </script>
    
    
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://js.arcgis.com/3.46/"></script> -->
    <!-- Local JS Files -->
    <script src="{% static 'assets/js/styles.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap53.bundle.min.js' %}"></script>
    <script src="{% static 'lib/leaflet/dist/leaflet.js' %}"></script>
    
    <script src="{% static 'lib/highcharts/highcharts.js' %}"></script>
    <script src="{% static 'lib/highcharts/highcharts-more.js' %}"></script>
    <script src="{% static 'assets/js/map.js' %}"></script>
    <script src="{% static 'assets/js/graph.js' %}"></script>
    
    <script src="{% static 'assets/js/loader.js' %}"></script>




    <script>// Toast functionality
        function showToast(message, type = 'success') {
            const colors = {
                success: 'text-bg-success',
                error: 'text-bg-danger',
                info: 'text-bg-info',
                warning: 'text-bg-warning',
            };

            const containerId = 'toast-container';
            let container = document.getElementById(containerId);

            // Create container if not already in DOM
            if (!container) {
                container = document.createElement('div');
                container.id = containerId;
                container.className = 'toast-container position-fixed top-0 end-0 p-3';
                document.body.appendChild(container);
            }

            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast align-items-center ${colors[type]} border-0`;
            toast.role = 'alert';
            toast.ariaLive = 'assertive';
            toast.ariaAtomic = 'true';
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;

            container.appendChild(toast);

            // Initialize Bootstrap toast
            const bsToast = new bootstrap.Toast(toast, {
                delay: 4000,
                autohide: true
            });

            bsToast.show();

            // Remove from DOM after it hides
            toast.addEventListener('hidden.bs.toast', () => toast.remove());
        }


        {% if messages %}
        document.addEventListener('DOMContentLoaded', function () {
            {% for message in messages %}
            showToast(`{{ message|escapejs }}`, `{{ message.tags }}`);
            {% endfor %}
        });
        {% endif %}





const mapCityToId = {
        'Karachi': '#khi',
        'Karachi_City': '#city',
        'Lahore': '#lhr',
        'Islamabad': '#isl',
        'Quetta': '#qut',
        'Multan': '#mul',
        'Bahawalpur': '#bhwp',
        'Gujranwala': '#guj',
        'Peshawar': '#psw',
};


const mapDHATag = {
    'Karachi': 'DHA K',
    'Lahore': 'DHA L',
    'Islamabad': 'DHA IR',
    'Quetta': 'DHA Q',
    'Multan': 'DHA M',
    'Bahawalpur': 'DHA B',
    'Gujranwala': 'DHA G',
    'Karachi_City': 'DHA CITY',
    'Peshawar': 'DHA P',
};


function sortStationsGlobally(stations) {
    const dhaOrder = Object.keys(mapDHATag);
    return stations.sort((a, b) => {
        const orderA = dhaOrder.indexOf(a.station_name);
        const orderB = dhaOrder.indexOf(b.station_name);
        return (orderA === -1 ? Infinity : orderA) - (orderB === -1 ? Infinity : orderB);
    });
}

</script>

    
</body>

</html>
